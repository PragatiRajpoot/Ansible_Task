---
- name: install and set up grafana
  hosts: webservers
  become: yes
  tasks:
    - name: update apt repo and cache on all webservers
      apt:
        update_cache: yes
        force_apt_get: yes
        cache_valid_time: 3600
    - name: upgrade all packages on servers
      apt:
        upgrade: dist
        force_apt_get:yes
    - name: install required packages
      apt:
        name:
          - gnupg2
          - curl
          - software-properties-common
    - name: add the grafana GPG key
      shell:
        curl https://packages.grafana.com/gpg.key | sudo apt-key add - add-apt-repository "deb https://packages.grafana.com/oss/deb stable main"
        args:
          warn: no
    - name: install grafana package
      apt:
        name: grafana
        state: present
        update_cache: yes
      notify:
        - Start grafana
        - Enable grafana
    - name: Ensure Nginx is installed
      apt:
 
     
